{% extends "display/base.html" %}

{% block title %}
    Allen Brain
{% endblock %}

{% block dependencies %}
    <link rel="stylesheet" type="text/css"
          href="//cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"/>
{% endblock %}

{% block content %}
    <p>
        We can also use <a href="https://connectivity.brain-map.org/projection">
        Allen Brain Atlas website</a> to get the data for experiments. Format
        <em>.xml</em> (experiment) or <em>.csv</em> (experiments container).
    </p>

    <div class="btn-group btn-group-toggle" data-toggle="buttons">
      <label class="btn btn-light btn-outline-info active">
        <input type="radio" name="all-exp" id="all-exp" autocomplete="off" checked> All experiments
      </label>
      <label class="btn btn-light btn-outline-info">
        <input type="radio" name="form-exp" id="form-exp" autocomplete="off"> Search
      </label>
    </div>

    <br/><br/>

    <div class="table table-sm bg-light">
        <h3>Columns visibility</h3>
        <div class="columns-vis">
            <div class="form-check form-check-inline">
                <input class="toggle-vis form-check-input" type="checkbox" data-column="0"
                       id="experiment-id" value="experiment-id" autocomplete="off" checked/>
                <label class="form-check-label" for="experiment-id">experiment id</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="toggle-vis form-check-input" type="checkbox" data-column="1"
                       id="hemisphere-name" value="hemisphere-name" autocomplete="off" checked/>
                <label class="form-check-label" for="hemisphere-name">hemisphere name</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="toggle-vis form-check-input" type="checkbox" data-column="2"
                       id="product-id" value="product-id" autocomplete="off" checked/>
                <label class="form-check-label" for="product-id">product id</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="toggle-vis form-check-input" type="checkbox" data-column="3"
                       id="injection-vol" value="injection-vol" autocomplete="off" checked/>
                <label class="form-check-label" for="injection-vol">injection vol.</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="toggle-vis form-check-input" type="checkbox" data-column="4"
                       id="injection-xyz" value="injection-xyz" autocomplete="off" checked/>
                <label class="form-check-label" for="injection-xyz">injection (x,y,z)</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="toggle-vis form-check-input" type="checkbox" data-column="5"
                       id="transgenic-line" value="transgenic-line" autocomplete="off" checked/>
                <label class="form-check-label" for="transgenic-line">transgenic line</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="toggle-vis form-check-input" type="checkbox" data-column="6"
                       id="gender" value="gender" autocomplete="off" checked/>
                <label class="form-check-label" for="gender">gender </label>
            </div>
            <div class="form-check form-check-inline">
                <input class="toggle-vis form-check-input" type="checkbox" data-column="7"
                       id="specimen-name" value="specimen-name" autocomplete="off" checked/>
                <label class="form-check-label" for="specimen-name">specimen name</label>
            </div>
        </div>

        <hr style="border: 1px solid black"/>

        <table id="experiments" class="datatable" cellspacing="0" width="100%">
            <!-- https://datatables.net/examples/api/show_hide.html -->
            <thead>
                <th>experiment id</th>
                <th>hemisphere name</th>
                <th>product id</th>
                <th>injection vol.</th>
                <th>injection (x,y,z)</th>
                <th>transgenic line</th>
                <th>gender</th>
                <th>specimen name</th>
            </thead>

            <tfoot>
                <th>experiment id</th>
                <th>hemisphere name</th>
                <th>product id</th>
                <th>injection vol.</th>
                <th>injection (x,y,z)</th>
                <th>transgenic line</th>
                <th>gender</th>
                <th>specimen name</th>
            </tfoot>

            <tbody>
                <!-- for each experiments -->
                {% for i in range(0, nb_exp) %}
                <tr>
                    <td>
                        <!-- get experiment id -->
                        {{ all_exp.iloc[i]['id'] }}
                    </td>
                    <td>
                        <!-- get hemisphere name -->
                        {{ all_exp.iloc[i]['structure_name'] }}
                        ({{ all_exp.iloc[i]['structure_abbrev'] }})
                    </td>
                    <td>
                        <!-- get product id -->
                        {{ all_exp.iloc[i]['product_id'] }}
                    </td>
                    <td>
                        <!-- get injection volume -->
                        {{ all_exp.iloc[i]['injection_volume'] }}
                    </td>
                    <td>
                        <!-- get injection coordinates -->
                        ({{ all_exp.iloc[i]['injection_x'] }},
                        {{ all_exp.iloc[i]['injection_y'] }},
                        {{ all_exp.iloc[i]['injection_z'] }})
                    </td>
                    <td>
                        <!-- get specimen name -->
                        {{ all_exp.iloc[i]['transgenic_line'] }}
                    </td>
                    <td>
                        <!-- get specimen gender -->
                        {{ all_exp.iloc[i]['gender'] }}
                    </td>
                    <td>
                        <!-- get specimen name -->
                        {{ all_exp.iloc[i]['specimen_name'] }}
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="form-exp bg-light">
        <h3>Experiments criteria</h3>
        <form action="#" method="post">
            <div class="form-group">
                <label for="structures">Structures names or acronyms</label>
                <input type="text" class="form-control" id="structures" name="structure[]" placeholder="Enter structures">
            </div>
            <div class="form-group">
                <label for="exampleInputEmail1">Email address</label>
                <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
            </div>
            <div class="form-group">
                <label for="exampleInputPassword1">Password</label>
                <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
            </div>
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="exampleCheck1">
                <label class="form-check-label" for="exampleCheck1">Check me out</label>
            </div>
            <button type="submit" class="btn btn-success">Submit</button>
        </form>
    </div>
{% endblock %}

{% block dependenciesScripts %}
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="//cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript">
        // show form and hide table
        $("#form-exp").click(function(){
            $('.table').hide()
            $('.form-exp').show()
        });

        // show table and hide form
        $("#all-exp").click(function(){
            $('.form-exp').hide()
            $('.table').show()
        });

        $(document).ready( function () {
            // hide table with experiments
            $('.form-exp').hide()

            // activate datatable
            var table = $('#experiments').DataTable({
                "scrollX": true
            });

            // columns visibilty in datatable
            $('.toggle-vis').on( 'click', function (e) {
                // Get the column API object
                var column = table.column( $(this).attr('data-column') );

                // Toggle the visibility
                column.visible( ! column.visible() );
            } );
        } );
    </script>
{% endblock %}