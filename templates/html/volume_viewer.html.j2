{% extends "html/base.html.j2" %}

{% block title %}
    Volume viewer
{% endblock %}

{% block dependencies %}
    <link type="text/css" rel="stylesheet"
          href="{{ url_for('static', filename='css/jquery-ui-1.8.10.custom.css') }}"/>
    <link type="text/css" rel="stylesheet"
          href="{{ url_for('static', filename='css/common.css') }}"/>
    <link type="text/css" rel="stylesheet"
          href="{{ url_for('static', filename='css/volume-viewer.css') }}"/>
{% endblock %}

{% block content %}
  <script id="volume-ui-template" type="x-volume-ui-template">
    <div class="volume-viewer-display">
    </div>
    <div class="volume-viewer-controls volume-controls">

      <div class="coords">
        <div class="control-heading" id="voxel-coordinates-heading-{{VOLID}}">
          Voxel Coordinates:
        </div>
        <div class="voxel-coords" data-volume-id="{{VOLID}}">
          I:<input id="voxel-i-{{VOLID}}" class="control-inputs">
          J:<input id="voxel-j-{{VOLID}}" class="control-inputs">
          K:<input id="voxel-k-{{VOLID}}" class="control-inputs">
        </div>
        <div class="control-heading" id="world-coordinates-heading-{{VOLID}}">
          World Coordinates:
        </div>
        <div class="world-coords" data-volume-id="{{VOLID}}">
          X:<input id="world-x-{{VOLID}}" class="control-inputs">
          Y:<input id="world-y-{{VOLID}}" class="control-inputs">
          Z:<input id="world-z-{{VOLID}}" class="control-inputs">
        </div>
      </div>

      <div id="intensity-value-div-{{VOLID}}">
        <span class="control-heading" data-volume-id="{{VOLID}}">
          Value:
        </span>
        <span id="intensity-value-{{VOLID}}" class="intensity-value"></span>
      </div>

      <div id="color-map-{{VOLID}}">
        <span class="control-heading" id="color-map-heading-{{VOLID}}">
          Color Map:
        </span>
      </div>

      <div id="color-map-file-{{VOLID}}" class="color-map-file-div" data-volume-id="{{VOLID}}" >
        <span class="control-heading">Color map file: </span><input type="file" name="color-map-file-{{VOLID}}" class="color-map-file">
      </div>

      <div class="threshold-div" data-volume-id="{{VOLID}}">
        <div class="control-heading">
          Threshold:
        </div>
        <div class="thresh-inputs">
          <input id="min-threshold-{{VOLID}}" class="control-inputs thresh-input-left" value="0"/>
          <input id="max-threshold-{{VOLID}}" class="control-inputs thresh-input-right" value="255"/>
        </div>
        <div class="slider volume-viewer-threshold" id="threshold-slider-{{VOLID}}"></div>
      </div>

      <div id="time-{{VOLID}}" class="time-div" data-volume-id="{{VOLID}}" style="display:none">
        <span class="control-heading">Time:</span>
        <input class="control-inputs" value="0" id="time-val-{{VOLID}}"/>
        <div class="slider volume-viewer-threshold" id="time-slider-{{VOLID}}"></div>
        <input type="checkbox" class="button" id="play-{{VOLID}}"><label for="play-{{VOLID}}">Play</label>
      </div>

      <div class="contrast-div" data-volume-id="{{VOLID}}">
        <span class="control-heading" id="contrast-heading{{VOLID}}">Contrast (0.0 to 2.0):</span>
        <input class="control-inputs" value="1.0" id="contrast-val"/>
        <div id="contrast-slider" class="slider volume-viewer-contrast"></div>
      </div>

      <div class="brightness-div" data-volume-id="{{VOLID}}">
        <span class="control-heading" id="brightness-heading{{VOLID}}">Brightness (-1 to 1):</span>
        <input class="control-inputs" value="0" id="brightness-val"/>
        <div id="brightness-slider" class="slider volume-viewer-brightness"></div>
      </div>

      <div id="slice-series-{{VOLID}}" class="slice-series-div" data-volume-id="{{VOLID}}">
        <div class="control-heading" id="slice-series-heading-{{VOLID}}">All slices: </div>
        <span class="slice-series-button button" data-axis="xspace">Sagittal</span>
        <span class="slice-series-button button" data-axis="yspace">Coronal</span>
        <span class="slice-series-button button" data-axis="zspace">Transverse</span>
      </div>

    </div>
  </script>
  <script id="overlay-ui-template" type="x-volume-ui-template">
    <div class="overlay-viewer-display">
    </div>
    <div class="volume-viewer-controls volume-controls">

      <div class="coords">
        <div class="control-heading" id="voxel-coordinates-heading-{{VOLID}}">
          Voxel Coordinates:
        </div>
        <div class="voxel-coords" data-volume-id="{{VOLID}}">
          I:<input id="voxel-i-{{VOLID}}" class="control-inputs">
          J:<input id="voxel-j-{{VOLID}}" class="control-inputs">
          K:<input id="voxel-k-{{VOLID}}" class="control-inputs">
        </div>
        <div class="control-heading" id="world-coordinates-heading-{{VOLID}}">
          World Coordinates:
        </div>
        <div class="world-coords" data-volume-id="{{VOLID}}">
          X:<input id="world-x-{{VOLID}}" class="control-inputs">
          Y:<input id="world-y-{{VOLID}}" class="control-inputs">
          Z:<input id="world-z-{{VOLID}}" class="control-inputs">
        </div>
      </div>

      <div id="intensity-value-div-{{VOLID}}">
        <span class="control-heading" data-volume-id="{{VOLID}}">
          Value:
        </span>
        <span id="intensity-value-{{VOLID}}" class="intensity-value"></span>
      </div>

      <div class="blend-div" data-volume-id="{{VOLID}}">
        <span class="control-heading" id="blend-heading{{VOLID}}">Blend (0.0 to 1.0):</span>
        <input class="control-inputs" value="0.5" id="blend-val"/>
        <div id="blend-slider" class="slider volume-viewer-blend"></div>
      </div>

      <div class="contrast-div" data-volume-id="{{VOLID}}">
        <span class="control-heading" id="contrast-heading{{VOLID}}">Contrast (0.0 to 2.0):</span>
        <input class="control-inputs" value="1.0" id="contrast-val"/>
        <div id="contrast-slider" class="slider volume-viewer-contrast"></div>
      </div>

      <div class="brightness-div" data-volume-id="{{VOLID}}">
        <span class="control-heading" id="brightness-heading{{VOLID}}">Brightness (-1 to 1):</span>
        <input class="control-inputs" value="0" id="brightness-val"/>
        <div id="brightness-slider" class="slider volume-viewer-brightness"></div>
      </div>
    </div>
  </script>

  {# <div id="loading" style="display: none"><img src="https://brainbrowser.cbrain.mcgill.ca/img/ajax-loader.gif" /></div> #}

  <div id="brainbrowser-wrapper">
    <div id="volume-viewer">
      <div id="global-controls" class="volume-viewer-controls">
        <span class="control-heading">Volume type:</span>
        <select id="volume-type">
          <option value="NIfTI-1">NIfTI-1</option>
          <option value="structural_minc">MINC Structural</option>
          <option value="functional_minc">MINC Functional</option>
          <option value="MGH">FreeSurfer/MGH</option>
          <option value="file">Load your own volume!</option>
        </select>
        <span class="control-heading">Panel size:</span>
        <select id="panel-size">
          <option value="-1">Auto</option>
          <option value="128">128</option>
          <option value="256" SELECTED>256</option>
          <option value="512">512</option>
        </select>
        <span id="sync-volumes-wrapper">
          <input type="checkbox" class="button" id="sync-volumes"><label for="sync-volumes">Synchronize</label>
        </span>
        <span id="screenshot" class="button">Screenshot</span>

        <div id="volume-file" class="file-select">
          <h3><u>For MINC file:</u></h3>
          <div>
            <span class="control-heading">MINC file: </span><input type="file" name="raw-data-file" id="raw-data-file">
          </div>
          <div id="volume-file-minc-submit">
            <span class="button">Load</span>
          </div>

          <h3><u>For NIfTI-1 file:</u></h3>
          <div>
            <span class="control-heading">NIfTI-1 file: </span><input type="file" name="nifti1-file" id="nifti1-file">
          </div>
          <div id="volume-file-nifti1-submit">
            <span class="button">Load</span>
          </div>

          <h3><u>For MGH file:</u></h3>
          <div>
            <span class="control-heading">MGH file: </span><input type="file" name="mgh-file" id="mgh-file">
          </div>
          <div id="volume-file-mgh-submit">
            <span class="button">Load</span>
          </div>

        </div>

        <div class="instructions">Shift-click to drag. Hold ctrl to measure distance.</div>
      </div>
      <div id="brainbrowser"></div>
    </div>
  </div>
{% endblock %}

{% block dependenciesScripts %}
    {# brain browser for volume viewer #}
    {#
        Currently stuck with jquery-ui-1.8.10.custom.min.js which doesn't work with latest jquery.
        Without it, drawing volumes, widgets and colors-map don't work.
        Hence why I have jquery-1.6.4.min.js
        TODO if time allows it, update jquery-ui-1.8.10.custom.min.js
    #}
    <script type="text/javascript"
        src="https://brainbrowser.cbrain.mcgill.ca/js/lib/jquery-1.6.4.min.js">
    </script>
    <script
        type="text/javascript" src="{{ url_for('static', filename='js/lib/jquery/jquery-ui-1.8.10.custom.min.js') }}">
    </script>
    <script type="text/javascript"
        src="{{ url_for('static', filename='js/lib/brainbrowser/brainbrowser.volume-viewer.min.js') }}">
    </script>
    <script type="text/javascript"
        src="{{ url_for('static', filename='js/volume-viewer.config.js') }}">
    </script>
    <script type="text/javascript"
        src="{{ url_for('static', filename='js/volume-viewer.js') }}">
    </script>
{% endblock %}